{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat History - UniBuddy</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<script>tailwind.config = { darkMode: 'class' }</script>

<!-- Bootstrap CSS & JS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
    #chatbox {
        height: calc(100vh - 140px);
        overflow-y: auto;
        padding: 1rem;
    }
    .user-message {
        background-color: #703737;
        color: white;
        padding: 8px 12px;
        border-radius: 20px;
        max-width: 70%;
        word-wrap: break-word;
    }
    .bot-message {
        background-color: #f3f4f6;
        color: #111827;
        padding: 8px 12px;
        border-radius: 20px;
        max-width: 70%;
        word-wrap: break-word;
    }
    .dark .user-message { background-color: #b55b5b; }
    .dark .bot-message { background-color: #1f2937; color: #f3f4f6; }
</style>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300">

<header class="bg-white dark:bg-gray-800 border-b px-4 py-3 flex items-center justify-between shadow-sm">
    <h1 class="text-lg font-semibold text-gray-800 dark:text-gray-200 flex-1 text-center">Your Chat History</h1>
    <div class="flex gap-2 items-center">
        <a href="{% url 'chatbot_home' %}" class="px-3 py-1 rounded-lg bg-[#703737] text-white text-sm hover:bg-[#582e2e] transition">Back to Chat</a>
        <button id="clear-history-btn" class="px-3 py-1 rounded-lg bg-red-600 text-white text-sm hover:bg-red-700 transition">Clear Chat History</button>
        <button id="themeToggle" class="px-3 py-1 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-sm hover:bg-gray-300 dark:hover:bg-gray-600 transition">Toggle Theme</button>
    </div>
</header>

<main class="flex-1 flex flex-col">
    <div id="chatbox" class="flex-1 flex flex-col space-y-3 p-3">
        {% if chat_history %}
            {% for chat in chat_history %}
                {% if chat.is_bot %}
                    <div class="flex justify-start">
                        <div class="bot-message">{{ chat.message }}</div>
                    </div>
                {% else %}
                    <div class="flex justify-end">
                        <div class="user-message">{{ chat.message }}</div>
                    </div>
                {% endif %}
            {% endfor %}
        {% else %}
            <div class="text-center text-gray-500 dark:text-gray-400">No chat history found.</div>
        {% endif %}
    </div>
</main>

<script>
// Clear chat history
document.getElementById('clear-history-btn').addEventListener('click', function() {
    Swal.fire({
        title: 'Are you sure?',
        text: "This will delete all your chat history permanently!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Yes, clear it!'
    }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = "{% url 'clear_chat_history' %}";
        }
    });
});

// Dark/Light Theme Toggle
function setTheme(theme) {
    document.documentElement.classList.toggle('dark', theme==='dark');
    localStorage.setItem('theme', theme);
}

function initializeTheme() {
    const savedTheme = localStorage.getItem('theme');
    if(savedTheme) setTheme(savedTheme);
    else setTheme(window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark':'light');
}

initializeTheme();

document.getElementById("themeToggle").addEventListener("click", () => {
    const current = document.documentElement.classList.contains("dark") ? "dark" : "light";
    setTheme(current === "dark" ? "light" : "dark");
});

// Auto-scroll chat to bottom
const chatbox = document.getElementById('chatbox');
chatbox.scrollTop = chatbox.scrollHeight;
</script>

</body>
</html>
